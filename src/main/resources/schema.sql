CREATE TABLE IF NOT EXISTS MPA
(
    ID   INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME CHARACTER VARYING NOT NULL
);

CREATE TABLE IF NOT EXISTS OPERATION
(
    ID   INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME CHARACTER VARYING NOT NULL
);
CREATE TABLE IF NOT EXISTS EVENT_TYPE
(
    ID   INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME CHARACTER VARYING NOT NULL
);

CREATE TABLE IF NOT EXISTS USERS
(
    ID       INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME     CHARACTER VARYING,
    LOGIN    CHARACTER VARYING NOT NULL,
    EMAIL    CHARACTER VARYING,
    BIRTHDAY DATE
);

CREATE TABLE IF NOT EXISTS FILM
(
    ID           INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME         CHARACTER VARYING NOT NULL,
    DESCRIPTION  CHARACTER VARYING,
    RELEASE_DATE DATE,
    DURATION     INTEGER,
    RATE         CHARACTER VARYING
);

CREATE TABLE IF NOT EXISTS REVIEWS
(
    ID            INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CONTENT       CHARACTER VARYING,
    STATUS        CHARACTER VARYING,
    USER_ID       INTEGER REFERENCES USERS (ID),
    FILM_ID       INTEGER REFERENCES FILM (ID),
    CREATION_DATE DATE
);

CREATE TABLE IF NOT EXISTS REVIEWS_LIKES
(
    REVIEW_ID     INTEGER REFERENCES REVIEWS (ID),
    USER_ID       INTEGER REFERENCES USERS (ID),
    USERFUL       CHARACTER VARYING,
    CREATION_DATE DATE
);

CREATE TABLE IF NOT EXISTS FEED
(
    EVENT_ID      INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_ID       INTEGER NOT NULL REFERENCES USERS (ID),
    OPERATION_ID  INTEGER NOT NULL REFERENCES OPERATION (ID),                                        -- одно из значениий REMOVE, ADD, UPDATE
    EVENT_TYPE_ID INTEGER NOT NULL REFERENCES EVENT_TYPE (ID),                                       --одно из значениий LIKE, REVIEW или FRIEND
    ENTITY_ID     INTEGER NOT NULL REFERENCES USERS (ID) REFERENCES FILM (ID) REFERENCES REVIEWS (ID)--идентификатор сущности, с которой произошло событие
);

CREATE TABLE IF NOT EXISTS GENRE
(
    ID   INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY UNIQUE,
    NAME CHARACTER VARYING UNIQUE
);

CREATE TABLE IF NOT EXISTS FILM_GENRE
(
    FILM_ID  INTEGER NOT NULL REFERENCES FILM (ID),
    GENRE_ID INTEGER NOT NULL REFERENCES GENRE (ID)
);

CREATE TABLE IF NOT EXISTS FILM_MPA
(
    FILM_ID INTEGER NOT NULL REFERENCES FILM (ID),
    MPA_ID  INTEGER NOT NULL REFERENCES MPA (ID)
);

CREATE TABLE IF NOT EXISTS LIKES
(
    FILM_ID INTEGER NOT NULL REFERENCES FILM (ID),
    USER_ID INTEGER NOT NULL REFERENCES USERS (ID)
);

CREATE TABLE IF NOT EXISTS FRIENDSHIP
(
    USER_ID   INTEGER NOT NULL REFERENCES USERS (ID),
    FRIEND_ID INTEGER NOT NULL REFERENCES USERS (ID)
);

CREATE TABLE IF NOT EXISTS FEED
(
    EVENT_ID    INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CREATE_TIME TIMESTAMP,
    USER_ID     INTEGER           NOT NULL REFERENCES USERS (ID),
    OPERATION   CHARACTER VARYING NOT NULL,
    EVENT_TYPE  CHARACTER VARYING NOT NULL,
    ENTITY_ID   INTEGER           NOT NULL
);

INSERT INTO MPA (NAME)
VALUES ('G'),
       ('PG'),
       ('PG-13'),
       ('R'),
       ('NC-17');

INSERT INTO GENRE (NAME)
VALUES ('Комедия'),
       ('Драма'),
       ('Мультфильм'),
       ('Триллер'),
       ('Документальный'),
       ('Боевик');

INSERT INTO OPERATION(NAME)
VALUES ('Add'),
       ('Update'),
       ('Remove');

INSERT INTO EVENT_TYPE(NAME)
VALUES ('LIKE'),
       ('REVIEW'),
       ('FRIEND');

INSERT INTO USERS (NAME, LOGIN, EMAIL, BIRTHDAY)
VALUES ('user1', 'login1', 'user@yandex.ru', '2000-12-12');

INSERT INTO USERS(NAME, LOGIN, EMAIL, BIRTHDAY)
VALUES ('user2', 'login2', 'user@yandex.ru', '2000-12-12');

INSERT INTO USERS(NAME, LOGIN, EMAIL, BIRTHDAY)
VALUES ('user3', 'login3', 'user@yandex.ru', '2000-12-12');

INSERT INTO FRIENDSHIP(USER_ID, FRIEND_ID)
VALUES ('1', '2');

INSERT INTO FRIENDSHIP(USER_ID, FRIEND_ID)
VALUES ('3', '2');

INSERT INTO FILM(NAME, DESCRIPTION, RELEASE_DATE, DURATION, RATE)
VALUES ('film1', 'descr1', '2020-10-10', '120', '1');

INSERT INTO FILM(NAME, DESCRIPTION, RELEASE_DATE, DURATION, RATE)
VALUES ('film2', 'descr2', '2020-10-10', '120', '2');

INSERT INTO LIKES (FILM_ID, USER_ID)
VALUES ('1', '1');

INSERT INTO FEED(CREATE_TIME, USER_ID, OPERATION, EVENT_TYPE, ENTITY_ID)
VALUES ('2022-11-23T19:27:09.216233900', '2', 'ADD', 'LIKE', '1');